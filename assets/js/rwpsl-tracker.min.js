jQuery(document).ready(function($) {

    if (typeof rwpsl_ajax !== 'undefined' && rwpsl_ajax.post_id) {
        var postId = rwpsl_ajax.post_id;
        var cookieName = 'rwpsl_viewed_' + postId;
        var expiresHours = 12


        // 获取 cookie
        function getCookie(name) {
            var value = '; ' + document.cookie;
            var parts = value.split('; ' + name + '=');
            if (parts.length === 2) return parts.pop().split(';').shift();
        }

        // 设置 cookie（expires 小时）
        function setCookie(name, value, hours) {
            var date = new Date();
            date.setTime(date.getTime() + (hours * 60 * 60 * 1000));
            var expires = 'expires=' + date.toUTCString();
            document.cookie = name + '=' + value + '; ' + expires + '; path=/; SameSite=Strict';
        }

        if (!getCookie(cookieName)) {

            $.ajax({
                url: rwpsl_ajax.ajax_url,
                type: 'POST',
                data: {
                    action: 'rwpsl_add_view',
                    post_id: postId,
                    nonce: rwpsl_ajax.nonce,
                    nonce_action: rwpsl_ajax.nonce_action
                },
                success: function(response) {
                    console.log(response);
                },
                error: function(err) {
                    console.log('AJAX Error:', err.status+' '+err.statusText);
                }
            });


            // 设置 cookie，防止 12 小时内重复统计
            setCookie(cookieName, '1', expiresHours);
        }
    }
});
